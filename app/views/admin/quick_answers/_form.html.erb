<%= render :partial => 'shared/pagedown' %>

<script type="text/javascript">
  $('li#article_reviewer_input').hide()
</script>


<%= semantic_form_for [:admin, @quick_answer] do |f| %>

  <% if current_user.is_admin? %>
    <%= f.inputs "Administration" do%>
      <%= f.input :status, :as => :select, :collection => ([@quick_answer.status] + ["Published", "Review by...", "Pending Review", "Draft"]).uniq, :include_blank => false %>
      <li class="select input optional" id="article_reviewer_input">
        <label class="label">Reviewer</label>
        <select id="article_reviewer">
          <% User.all.each do |u| %>
            <option value="<%= u.email %>"><%=u.email%></option>
          <% end %>
        </select>
      </li>
      <%= f.input :user, :label => "Writer / editor" %>
    <% end %>
    <script type="text/javascript">
  $('li#article_reviewer_input').hide()
      $('select#quick_answer_status').change(function(ev) {
        var selected = ev.delegateTarget.value;
        if ( selected == "Review by...") {
          $('li#article_reviewer_input').show();
        } else {
          $('li#article_reviewer_input').hide();
        }
      });
      $('select#article_reviewer').change(function(ev) {
        var reviewer = ev.delegateTarget.value;
        var new_status = "Review by " + reviewer;
        $('select#quick_answer_status').append('<option value="' + new_status + '" selected="selected">' + new_status + '</option>')
      })
    </script>
  <% end %> <!-- admin -->

  <%= f.inputs "Quick Answer Details" do %>
    <%=f.input :title %>
    <%=f.input :preview, :input_html => { :rows => 4 } %>
    <%=f.input :category %>
    <%=f.input :contact, :label => "Contact / More Info" %>
    <%=f.input :tags, :as => :string, :label => "Keywords" %>
    <%=f.input :author_link, :label => "Write-a-thon Author Link" %>
    <%=f.input :author_pic, :label => "Write-a-thon Author Pic" %>
    <% if @article.author_pic.exists? %>
      <li class="file input optional">
        <div class="author_image">
          <%= image_tag(@article.author_pic.url(:thumb), :alt => "Current Write-a-thon Author Pic", :title => "Current Write-a-thon Author Pic") %>
        </div>
      </li>
    <% end %>
    <%=f.input :author_name, :label => "Write-a-thon Author Name" %>
  <% end %> <!-- details -->

  <%= f.inputs "Content" do %>
    <% if @article.legacy? %>
      <h2 style="line-height: 2em; padding-left: 15em;"><strong>This article was written before Honolulu Answers migrated to Markdown.  In order to edit its contents, change the below selection to "No", and make sure the content boxes are properly formatted.</strong></h2>
      <%=f.input :render_markdown, :label => "Legacy article?", :as => :radio, :collection => [["No", true], ["Yes", false]] %>
    <% end %>

    <div class="wmd-panel">
      <div id="wmd-button-bar-content_main" class="wmd-button-bar"></div>
      <%= f.input :content_main, :label => "Content for Gray Box", :input_html => {
          :class => 'wmd-input', :id => 'wmd-input-content_main'} %>
      <div id="wmd-preview-content_main" class="wmd-preview article"></div>
    </div>
    <div class="clear"></div>

    <div class="wmd-panel">
      <div id="wmd-button-bar-content_main_extra" class="wmd-button-bar"></div>
      <%= f.input :content_main_extra, :input_html => {
          :class => 'wmd-input', :id => 'wmd-input-content_main_extra'}  %>
      <div id="wmd-preview-content_main_extra" class="wmd-preview article"></div>
    </div>

    <div class="clear"></div>
    <div class="wmd-panel">
      <div id="wmd-button-bar-content_need_to_know" class="wmd-button-bar"></div>
      <%= f.input :content_need_to_know, :input_html => {
          :class => 'wmd-input', :id => 'wmd-input-content_need_to_know'} %>
      <div id="wmd-preview-content_need_to_know" class="wmd-preview article"></div>
    </div>
  <%end%> <!-- content -->

  <!-- editor actions -->
  <% if current_user.is_editor? %>
    <script type="text/javascript">
      function statusToSave(){
        // status does not change
        if( typeof $("#isediting:checked").val() != "undefined" ){
          // acting as an editor
          $("#quick_answer_status").val("Review by <%= current_user.email %>");
        }
        else{
          // acting as a writer
          $("#quick_answer_status").val("Pending Review");
        }
        $("form")[0].submit();
      }
      function statusToRevise(){
        // status changed from
        $("#quick_answer_status").val("Draft");
        $("form")[0].submit();
      }
      function statusToPublish(){
        $("#quick_answer_status").val("Published");
        $("form")[0].submit();
      }
    </script>

    <h4>Are you editing or writing this article?</h4>
    <label>
      <input id="isediting" type="radio" name="role" value="editor" checked="checked"/>
      I commit to editing
    </label>
    --
    <label>
      <input id="iswriting" type="radio" name="role" value="writer"/>
      I am writing
    </label>
    <br/>
    <br/>
    <ol>
      <li class="commit button">
        <input type="button" value="Save" onclick="statusToSave();"/>
      </li>
      <li class="commit button">
        <input type="button" value="Ask Writer to Revise" onclick="statusToRevise();"/>
      </li>
      <% if :status != "Draft"  %>
        <li class="commit button">
          <input type="button" value="Publish" onclick="statusToPublish();"/>
        </li>
      <% end %>
    </ol>
  <% end %> <!-- editor actions -->

  <!-- writer actions -->
  <% if current_user.is_writer? %>
    <script type="text/javascript">
      function statusToSave(){
        // status does not change
        $("form")[0].submit();
      }
      function statusToReview(){
        // status changed from draft to Pending Review
        $("#quick_answer_status").val("Pending Review");
        $("form")[0].submit();
      }
    </script>
    <ol>
      <li class="commit button">
        <input type="button" value="Save Draft" onclick="statusToSave();"/>
      </li>
      <li class="commit button">
        <input type="button" value="Ready to Review" onclick="statusToReview();"/>
      </li>
    </ol>
  <% end %> <!-- writer actions -->

  <!-- admin actions -->
  <% if current_user.is_admin? %>
    <%= f.buttons :commit %>
  <% end %> <!-- admin actions -->

<% end %>
